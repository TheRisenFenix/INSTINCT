{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "CLEAN: Remove Build Files",
            "type": "shell",
            "group": "build",
            "command": "rm",
            "args": [
                "-rf",
                "build"
            ],
            "windows": {
                "command": "Remove-Item",
                "args": [
                    "-Recurse",
                    "build"
                ]
            },
            "presentation": {
                "reveal": "never",
                "echo": false,
                "showReuseMessage": false
            },
            "problemMatcher": []
        },
        {
            "label": "CLEAN: Tests",
            "type": "shell",
            "group": "build",
            "command": "rm",
            "args": [
                "-rf",
                "test/logs/[^\\.]*"
            ],
            "windows": {
                "command": "Remove-Item",
                "args": [
                    "-Recurse",
                    "build"
                ]
            },
            "presentation": {
                "reveal": "never",
                "echo": false,
                "showReuseMessage": false
            },
            "problemMatcher": []
        },
        {
            "label": "Conan: Detect",
            "type": "shell",
            "group": "build",
            "command": "bash",
            "args": [
                "-c",
                "export CC=$([[ \"${input:compiler}\" == \"gcc\" ]] && echo gcc || echo clang) && export CXX=$([[ \"${input:compiler}\" == \"gcc\" ]] && echo g++ || echo clang++) && conan profile detect --force"
            ],
            "presentation": {
                "clear": true
            },
            "problemMatcher": []
        },
        {
            "label": "Conan",
            "type": "shell",
            "group": "build",
            "command": "bash",
            "args": [
                "-c",
                "export CC=$([[ \"${input:compiler}\" == \"gcc\" ]] && echo gcc || echo clang) && export CXX=$([[ \"${input:compiler}\" == \"gcc\" ]] && echo g++ || echo clang++) && conan install . --build=missing -s build_type=${input:buildType} -s compiler.cppstd=20"
            ],
            "dependsOn": [
                "Conan: Detect"
            ],
            "problemMatcher": []
        },
        {
            "label": "Conan: Debug",
            "type": "shell",
            "group": "build",
            "command": "bash",
            "args": [
                "-c",
                "export CC=$([[ \"${input:compiler}\" == \"gcc\" ]] && echo gcc || echo clang) && export CXX=$([[ \"${input:compiler}\" == \"gcc\" ]] && echo g++ || echo clang++) && conan install . --build=missing -s build_type=Debug -s compiler.cppstd=20"
            ],
            "dependsOn": [
                "Conan: Detect"
            ],
            "problemMatcher": []
        },
        {
            "label": "Conan: Release",
            "type": "shell",
            "group": "build",
            "command": "bash",
            "args": [
                "-c",
                "export CC=$([[ \"${input:compiler}\" == \"gcc\" ]] && echo gcc || echo clang) && export CXX=$([[ \"${input:compiler}\" == \"gcc\" ]] && echo g++ || echo clang++) && conan install . --build=missing -s build_type=Release -s compiler.cppstd=20"
            ],
            "dependsOn": [
                "Conan: Detect"
            ],
            "problemMatcher": []
        },
        {
            "label": "CMAKE: Main",
            "type": "shell",
            "group": "build",
            "command": "bash",
            "args": [
                "-c",
                "export CC=$([[ \"${input:compiler}\" == \"gcc\" ]] && echo gcc || echo clang) && export CXX=$([[ \"${input:compiler}\" == \"gcc\" ]] && echo g++ || echo clang++) && cmake -Bbuild/${input:buildType}-${input:compiler} -S. -DCMAKE_BUILD_TYPE=${input:buildType} -DCMAKE_TOOLCHAIN_FILE=build/${input:buildType}/generators/conan_toolchain.cmake -DENABLE_MAIN=ON -DENABLE_TESTING=OFF -DENABLE_DOXYGEN=OFF -DENABLE_CLANG_TIDY=$(echo \"${input:clangTidy}\" | sed \"s/.*: //\") -DENABLE_CPPCHECK=$(echo \"${input:cppcheck}\" | sed \"s/.*: //\") -DLOG_LEVEL=$(echo \"${input:logLevel}\" | sed \"s/.*: //\") -DUSE_ALTERNATE_LINKER=${input:linker}"
            ],
            "windows": {
                "command": "cmake",
                "args": [
                    "-Bbuild/${input:buildType}-msvc",
                    "-S.",
                    "-DCMAKE_BUILD_TYPE=${input:buildType}",
                    "-DCMAKE_TOOLCHAIN_FILE=${workspaceFolder}/build/generators/conan_toolchain.cmake",
                    "-DENABLE_MAIN=ON",
                    "-DENABLE_TESTING=OFF",
                    "-DENABLE_DOXYGEN=OFF",
                    "-DLOG_LEVEL=DEBUG",
                    "-DENABLE_CLANG_TIDY=OFF",
                    "-DENABLE_CPPCHECK=OFF",
                    "-DENABLE_INCLUDE_WHAT_YOU_USE=OFF",
                    "-DWARNINGS_AS_ERRORS=OFF",
                    "-DUSE_ALTERNATE_LINKER=${input:linker}"
                ],
                "options": {
                    "env": {
                        "VSLANG": "1033",
                        "chcp": "1252"
                    }
                }
            },
            "dependsOn": [
                "Conan"
            ],
            "problemMatcher": []
        },
        {
            "label": "CMAKE: Testing",
            "type": "shell",
            "group": "build",
            "command": "bash",
            "args": [
                "-c",
                "export CC=$([[ \"${input:compiler}\" == \"gcc\" ]] && echo gcc || echo clang) && export CXX=$([[ \"${input:compiler}\" == \"gcc\" ]] && echo g++ || echo clang++) && cmake -Bbuild/${input:buildType}-${input:compiler} -S. -DCMAKE_BUILD_TYPE=${input:buildType} -DCMAKE_TOOLCHAIN_FILE=build/${input:buildType}/generators/conan_toolchain.cmake -DENABLE_MAIN=OFF -DENABLE_TESTING=ON -DENABLE_DOXYGEN=OFF -DENABLE_CLANG_TIDY=$(echo \"${input:clangTidy}\" | sed \"s/.*: //\") -DENABLE_CPPCHECK=$(echo \"${input:cppcheck}\" | sed \"s/.*: //\") -DLOG_LEVEL=$(echo \"${input:logLevel}\" | sed \"s/.*: //\") -DUSE_ALTERNATE_LINKER=${input:linker}"
            ],
            "windows": {
                "command": "cmake",
                "args": [
                    "-Bbuild/${input:buildType}-msvc",
                    "-S.",
                    "-DCMAKE_BUILD_TYPE=${input:buildType}",
                    "-DCMAKE_TOOLCHAIN_FILE=${workspaceFolder}/build/generators/conan_toolchain.cmake",
                    "-DENABLE_MAIN=OFF",
                    "-DENABLE_TESTING=ON",
                    "-DENABLE_DOXYGEN=OFF",
                    "-DLOG_LEVEL=TRACE",
                    "-DENABLE_CLANG_TIDY=OFF",
                    "-DENABLE_CPPCHECK=OFF",
                    "-DENABLE_INCLUDE_WHAT_YOU_USE=OFF",
                    "-DWARNINGS_AS_ERRORS=OFF"
                ],
                "options": {
                    "env": {
                        "VSLANG": "1033",
                        "chcp": "1252"
                    }
                }
            },
            "dependsOn": [
                "Conan"
            ],
            "problemMatcher": []
        },
        {
            "label": "CMAKE: Coverage",
            "type": "shell",
            "group": "build",
            "command": "cmake",
            "args": [
                "-Bbuild/Debug-cov",
                "-S.",
                "-DCMAKE_BUILD_TYPE=Debug",
                "-DCMAKE_TOOLCHAIN_FILE=build/Debug/generators/conan_toolchain.cmake",
                "-DENABLE_MAIN=OFF",
                "-DENABLE_TESTING=ON",
                "-DENABLE_DOXYGEN=OFF",
                "-DENABLE_COVERAGE=TRUE",
                "-DLOG_LEVEL=TRACE",
                "-DENABLE_CLANG_TIDY=OFF",
                "-DENABLE_CPPCHECK=OFF",
                "-DENABLE_INCLUDE_WHAT_YOU_USE=OFF",
                "-DUSE_ALTERNATE_LINKER=${input:linker}"
            ],
            "options": {
                "env": {
                    "CC": "/usr/bin/gcc",
                    "CXX": "/usr/bin/g++"
                }
            },
            "dependsOn": [
                "Conan: Debug"
            ],
            "problemMatcher": []
        },
        {
            "label": "CMAKE: Documentation",
            "type": "shell",
            "group": "build",
            "command": "bash",
            "args": [
                "-c",
                "export CC=$([[ \"${input:compiler}\" == \"gcc\" ]] && echo gcc || echo clang) && export CXX=$([[ \"${input:compiler}\" == \"gcc\" ]] && echo g++ || echo clang++) && cmake -Bbuild/Release-doc -S. -DCMAKE_BUILD_TYPE=Release -DCMAKE_TOOLCHAIN_FILE=build/Release/generators/conan_toolchain.cmake -DENABLE_MAIN=OFF -DENABLE_TESTING=OFF -DENABLE_DOXYGEN=ON -DENABLE_CLANG_TIDY=OFF -DENABLE_CPPCHECK=OFF -DLOG_LEVEL=OFF -DENABLE_INCLUDE_WHAT_YOU_USE=OFF -DDOC_CHECK_CODE_DOCUMENTATION=NO -DUSE_ALTERNATE_LINKER=${input:linker}"
            ],
            "dependsOn": [
                "Conan: Release"
            ],
            "problemMatcher": []
        },
        {
            "label": "CMAKE: Documentation Check",
            "type": "shell",
            "group": "build",
            "command": "bash",
            "args": [
                "-c",
                "export CC=$([[ \"${input:compiler}\" == \"gcc\" ]] && echo gcc || echo clang) && export CXX=$([[ \"${input:compiler}\" == \"gcc\" ]] && echo g++ || echo clang++) && cmake -Bbuild/Release-doc -S. -DCMAKE_BUILD_TYPE=Release -DCMAKE_TOOLCHAIN_FILE=build/Release/generators/conan_toolchain.cmake -DENABLE_MAIN=OFF -DENABLE_TESTING=OFF -DENABLE_DOXYGEN=ON -DENABLE_CLANG_TIDY=OFF -DENABLE_CPPCHECK=OFF -DLOG_LEVEL=OFF -DENABLE_INCLUDE_WHAT_YOU_USE=OFF -DDOC_CHECK_CODE_DOCUMENTATION=YES -DUSE_ALTERNATE_LINKER=${input:linker}"
            ],
            "dependsOn": [
                "Conan: Release"
            ],
            "problemMatcher": []
        },
        {
            "label": "CMAKE: Configure",
            "type": "shell",
            "group": "build",
            "command": "ccmake",
            "args": [
                "-Bbuild/${input:buildType}-${input:compiler}",
                "-S.",
                "-DCMAKE_BUILD_TYPE=${input:buildType}"
            ],
            "options": {
                "env": {
                    "CC": "/usr/bin/clang",
                    "CXX": "/usr/bin/clang++"
                }
            },
            "presentation": {
                "focus": true
            },
            "dependsOn": [
                "CMAKE: Main"
            ],
            "problemMatcher": []
        },
        {
            "label": "MAIN: Build project",
            "type": "shell",
            "group": "build",
            "command": "bash",
            "linux": {
                "args": [
                    "-c",
                    "cmake --build build/${input:buildType}-${input:compiler} --config ${input:buildType} --parallel$(nproc)"
                ]
            },
            "osx": {
                "command": "bash",
                "args": [
                    "-c",
                    "cmake --build build/${input:buildType}-${input:compiler} --config ${input:buildType} --parallel$(sysctl -n hw.physicalcpu)"
                ]
            },
            "windows": {
                "command": "cmake",
                "args": [
                    "--build",
                    "build/${input:buildType}-msvc",
                    "--config",
                    "${input:buildType}",
                    "--parallel8"
                ],
                "options": {
                    "env": {
                        "VSLANG": "1033",
                        "chcp": "1252"
                    }
                }
            },
            "dependsOn": [
                "CMAKE: Main"
            ],
            "problemMatcher": []
        },
        {
            "label": "TEST: Build project",
            "type": "shell",
            "group": "build",
            "linux": {
                "command": "bash",
                "args": [
                    "-c",
                    "cmake --build build/${input:buildType}-${input:compiler} --config ${input:buildType} --parallel$(nproc)"
                ]
            },
            "osx": {
                "command": "bash",
                "args": [
                    "-c",
                    "cmake --build build/${input:buildType}-${input:compiler} --config ${input:buildType} --parallel$(sysctl -n hw.physicalcpu)"
                ]
            },
            "windows": {
                "command": "cmake",
                "args": [
                    "--build",
                    "build/${input:buildType}-msvc",
                    "--config",
                    "${input:buildType}",
                    "--parallel8"
                ],
                "options": {
                    "env": {
                        "VSLANG": "1033",
                        "chcp": "1252"
                    }
                }
            },
            "dependsOn": [
                "CMAKE: Testing"
            ],
            "problemMatcher": []
        },
        {
            "label": "COVERAGE: Build Coverage Report",
            "type": "shell",
            "group": "build",
            "linux": {
                "command": "bash",
                "args": [
                    "-c",
                    "cmake --build build/Debug-cov --config ${input:buildType} --parallel$(nproc)"
                ]
            },
            "osx": {
                "command": "bash",
                "args": [
                    "-c",
                    "cmake --build build/Debug-cov --config ${input:buildType} --parallel$(sysctl -n hw.physicalcpu)"
                ]
            },
            "dependsOn": [
                "CMAKE: Coverage"
            ],
            "problemMatcher": []
        },
        {
            "label": "DOXYGEN: Build Documentation",
            "type": "shell",
            "group": "build",
            "command": "cmake",
            "args": [
                "--build",
                "build/Release-doc",
                "--target",
                "doc"
            ],
            "dependsOn": [
                "CMAKE: Documentation"
            ],
            "problemMatcher": []
        },
        {
            "label": "DOXYGEN: Check for errors",
            "type": "shell",
            "group": "test",
            "command": "cmake",
            "args": [
                "--build",
                "build/Release-doc",
                "--target",
                "doc"
            ],
            "dependsOn": [
                "CMAKE: Documentation Check"
            ],
            "problemMatcher": []
        },
        {
            "label": "MAIN: Build & run project",
            "type": "shell",
            "group": {
                "kind": "test",
                "isDefault": true
            },
            "command": "${workspaceFolder}/build/bin/${input:buildType}/instinct",
            "args": [
                "--config=config.ini",
                "--load=\"flow/Default.flow\"",
                "--console-log-level=trace",
                "--file-log-level=trace"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "dependsOn": [
                "MAIN: Build project"
            ],
            "problemMatcher": []
        },
        {
            "label": "TEST: Build & run",
            "type": "shell",
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "command": "ctest",
            "args": [
                "--output-on-failure"
            ],
            "options": {
                "cwd": "${workspaceFolder}/build/${input:buildType}-${input:compiler}"
            },
            "windows": {
                "options": {
                    "cwd": "${workspaceFolder}/build/${input:buildType}-msvc"
                }
            },
            "dependsOn": [
                "TEST: Build project"
            ],
            "problemMatcher": []
        },
        {
            "label": "TEST: Build & run w/o flow tests",
            "type": "shell",
            "group": "test",
            "command": "ctest",
            "args": [
                "-j4",
                "--output-on-failure",
                "--exclude-regex",
                "'\\[flow\\]'"
            ],
            "options": {
                "cwd": "${workspaceFolder}/build/${input:buildType}-${input:compiler}"
            },
            "dependsOn": [
                "TEST: Build project"
            ],
            "problemMatcher": []
        },
        {
            "label": "COVERAGE: Run Coverage Tests",
            "type": "shell",
            "group": "test",
            "command": "ctest",
            "args": [
                "-j4",
                "--output-on-failure"
            ],
            "options": {
                "cwd": "${workspaceFolder}/build/Debug-cov"
            },
            "dependsOn": [
                "COVERAGE: Build Coverage Report"
            ],
            "problemMatcher": []
        },
        {
            "label": "COVERAGE: Run Coverage Tests w/o flow tests",
            "type": "shell",
            "group": "test",
            "command": "ctest",
            "args": [
                "-j4",
                "--output-on-failure",
                "--exclude-regex",
                "'\\[flow\\]'"
            ],
            "options": {
                "cwd": "${workspaceFolder}/build/Debug-cov"
            },
            "dependsOn": [
                "COVERAGE: Build Coverage Report"
            ],
            "problemMatcher": []
        },
        {
            "label": "COVERAGE: Create",
            "type": "shell",
            "group": "test",
            "command": "bash",
            "args": [
                "-c",
                "mkdir -p build/coverage && gcovr --config doc/coverage/gcovr.cfg"
            ],
            "dependsOn": [
                "COVERAGE: Run Coverage Tests"
            ],
            "problemMatcher": []
        },
        {
            "label": "COVERAGE: Create w/o flow tests",
            "type": "shell",
            "group": "test",
            "command": "bash",
            "args": [
                "-c",
                "mkdir -p build/coverage && gcovr --config doc/coverage/gcovr.cfg"
            ],
            "dependsOn": [
                "COVERAGE: Run Coverage Tests w/o flow tests"
            ],
            "problemMatcher": []
        },
        {
            "label": "COVERAGE: Create & Show",
            "type": "shell",
            "group": "build",
            "command": "xdg-open",
            "args": [
                "build/coverage/index.html"
            ],
            "dependsOn": [
                "COVERAGE: Create"
            ],
            "problemMatcher": []
        },
        {
            "label": "COVERAGE: Create & Show w/o flow tests",
            "type": "shell",
            "group": "build",
            "command": "xdg-open",
            "args": [
                "build/coverage/index.html"
            ],
            "dependsOn": [
                "COVERAGE: Create w/o flow tests"
            ],
            "problemMatcher": []
        },
        {
            "label": "DOXYGEN: Create & Show",
            "type": "shell",
            "group": "build",
            "command": "xdg-open",
            "args": [
                "build/doc/html/index.html"
            ],
            "dependsOn": [
                "DOXYGEN: Build Documentation"
            ],
            "problemMatcher": []
        },
        {
            "label": "Gperftools: Run profiler",
            "type": "shell",
            "group": "test",
            "command": "${workspaceFolder}/build/bin/${input:buildType}/instinct",
            "args": [
                "--config=config.ini",
                "--load=\"flow/RTK-2020-08-05-Icare.flow\"",
                "--console-log-level=trace",
                "--file-log-level=trace"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "linux": {
                "options": {
                    "env": {
                        "CPUPROFILE": "build/bin/${input:buildType}/instinct.prof",
                        "CPUPROFILE_FREQUENCY": "500"
                    }
                }
            },
            "dependsOn": [
                "MAIN: Build project"
            ],
            "problemMatcher": []
        },
        {
            "label": "Gperftools: Show profiled output",
            "type": "shell",
            "group": "test",
            "command": "pprof",
            "args": [
                "--gv",
                "build/bin/${input:buildType}/instinct",
                "build/bin/${input:buildType}/instinct.prof"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "problemMatcher": []
        },
        {
            "label": "VALGRIND: Run profiler",
            "type": "shell",
            "group": "test",
            "command": "bash",
            "args": [
                "-c",
                "valgrind --callgrind-out-file=build/bin/${input:buildType}/callgrind.out --tool=callgrind build/bin/${input:buildType}/instinct -f config.ini --nogui -l flow/Default.flow && kcachegrind build/bin/${input:buildType}/callgrind.out"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "dependsOn": [
                "MAIN: Build project"
            ],
            "problemMatcher": []
        },
        {
            "label": "VALGRIND: Show profiled output",
            "type": "shell",
            "group": "test",
            "command": "kcachegrind",
            "args": [
                "build/bin/${input:buildType}/callgrind.out"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "problemMatcher": []
        },
        {
            "label": "VALGRIND: Memory Leak Check",
            "type": "shell",
            "group": "test",
            "command": "valgrind",
            "args": [
                "--leak-check=yes",
                "build/bin/${input:buildType}/instinct",
                "-f",
                "config.ini",
                "--nogui",
                "-l",
                "flow/Default.flow"
            ],
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "dependsOn": [
                "MAIN: Build project"
            ],
            "problemMatcher": []
        }
    ],
    // ╔══════════════════════════════════════════════════════════════════════════════════════════╗
    // ║                                   Status Bar Parameter                                   ║
    // ╚══════════════════════════════════════════════════════════════════════════════════════════╝
    "inputs": [
        { // buildType
            "id": "buildType",
            "type": "command",
            "command": "statusBarParam.get.buildType",
            "args": [
                "Debug",
                "Release",
            ],
        },
        { // compiler
            "id": "compiler",
            "type": "command",
            "command": "statusBarParam.get.compiler",
            "args": [
                "clang",
                "gcc",
            ],
        },
        { // linker
            "id": "linker",
            "type": "command",
            "command": "statusBarParam.get.linker",
            "args": [
                "mold",
                "ld",
                "gold",
                "lld",
                "bfd",
            ],
        },
        { // clang-tidy
            "id": "clangTidy",
            "type": "command",
            "command": "statusBarParam.get.clangTidy",
            "args": [
                "clang-tidy: OFF",
                "clang-tidy: ON",
            ],
        },
        { // cppcheck
            "id": "cppcheck",
            "type": "command",
            "command": "statusBarParam.get.cppcheck",
            "args": [
                "cppcheck: OFF",
                "cppcheck: ON",
            ],
        },
        { // logLevel
            "id": "logLevel",
            "type": "command",
            "command": "statusBarParam.get.logLevel",
            "args": [
                "Log Level: DATA",
                "Log Level: TRACE",
                "Log Level: DEBUG",
                "Log Level: INFO",
                "Log Level: WARN",
                "Log Level: ERROR",
                "Log Level: CRITICAL",
                "Log Level: OFF",
            ],
        },
    ],
}